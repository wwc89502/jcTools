import{i as Q,j as b,K as A,k as C,b as e,l as N,w as a,L as W,y as X,M as Y,N as E,U as B,E as Z,p as ee,O as le,s as ae,q as r,x as te,B as oe,G as ne,H as ue,g as L,F as M,d as q,I as se,C as U,P as de,o as _,c as z,u as ie,Q as re,_ as pe}from"./index-dlEj4opF.js";/* empty css                        *//* empty css                     *//* empty css                        */const me={class:"container"},ce={key:0,class:"group"},_e={class:"form-item"},fe={class:"mid"},ve=Q({__name:"Cll",setup(be){const V=b([]),f=b({}),d=b({}),D={name:[{required:!0,message:"请输入名称"}],size:[{required:!0,message:"请输入数量/重量"}],cal:[{required:!0,message:"请输入卡路里"}],unit:[{required:!0,message:"请选择/输入单位"}]},h=b(),O=()=>{h.value.validate(async o=>{o&&(await E.add(d.value),await k(),U.success("添加成功"),h.value.resetFields())})},R=async o=>{await E.update(o),await k(),U.success("修改成功")},S=o=>{de.confirm("确定要删除吗？","提示",{}).then(async()=>{await E.del(o.id),await k(),U.success("删除成功")})},T=async()=>{await B.update({...f.value,batch:JSON.stringify(f.value.batch)}),y.value=[],U.success("保存成功")},G=o=>{o.group||(o.group=[]),o.group.push({key:[]})},j=(o,l)=>{f.value.batch[o].group.splice(l,1)},J=o=>{const l=o.length,c=Math.floor(Math.random()*l);return o[c]},y=b([]),H=()=>{y.value=f.value.batch.map(o=>{let l=[];o.group.forEach((i,v)=>{l.push(J(i.key))});let c=[];return l.forEach((i,v)=>{const u=V.value.find(g=>g.id===i);c.push(`${u.name} ${u.size}${u.unit}`)}),{name:o.name,foods:c.join(",")}})},F=b(!1),k=async()=>{V.value=await E.getList();const o=await B.getList();f.value=o[0].batch?{...o[0],batch:JSON.parse(o[0].batch)}:{}};return A(async()=>{await k()}),(o,l)=>{const c=le,i=ee,v=ae,u=oe,g=te,p=X,K=Z,$=W,s=ue,w=ne,P=Y;return _(),C("div",me,[e($,{class:"add"},{default:a(()=>[e(K,{ref_key:"addFormRef",ref:h,model:d.value,rules:D,inline:""},{default:a(()=>[e(i,{prop:"name",label:"食物名称"},{default:a(()=>[e(c,{modelValue:d.value.name,"onUpdate:modelValue":l[0]||(l[0]=t=>d.value.name=t)},null,8,["modelValue"])]),_:1}),e(i,{prop:"size",label:"数量/重量"},{default:a(()=>[e(v,{"controls-position":"right",modelValue:d.value.size,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value.size=t)},null,8,["modelValue"])]),_:1}),e(i,{prop:"cal",label:"卡路里"},{default:a(()=>[e(v,{"controls-position":"right",modelValue:d.value.cal,"onUpdate:modelValue":l[2]||(l[2]=t=>d.value.cal=t)},{suffix:a(()=>l[6]||(l[6]=[r(" 千卡 ")])),_:1},8,["modelValue"])]),_:1}),e(i,{prop:"unit",label:"单位"},{default:a(()=>[e(g,{modelValue:d.value.unit,"onUpdate:modelValue":l[3]||(l[3]=t=>d.value.unit=t),"allow-create":"",filterable:""},{default:a(()=>[e(u,{value:"g"}),e(u,{value:"个"}),e(u,{value:"片"})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:a(()=>[e(p,{type:"primary",onClick:O},{default:a(()=>l[7]||(l[7]=[r("添加")])),_:1,__:[7]}),e(p,{type:"primary",plain:"",onClick:l[4]||(l[4]=t=>F.value=!0)},{default:a(()=>l[8]||(l[8]=[r("维护")])),_:1,__:[8]})]),_:1})]),_:1},8,["model"])]),_:1}),e($,{class:"top"},{default:a(()=>[e(w,{stripe:"",data:f.value.batch},{default:a(()=>[e(s,{prop:"name",label:"餐次",width:"100"}),e(s,{label:"组别"},{default:a(({row:t,$index:n})=>[t.group?.length?(_(),C("div",ce,[(_(!0),C(M,null,q(t.group,(x,I)=>(_(),z(i,{label:`组${I+1}`,class:"item",key:I},{default:a(()=>[N("div",_e,[e(g,{modelValue:x.key,"onUpdate:modelValue":m=>x.key=m,multiple:"","collapse-tags":"","collapse-tags-tooltip":""},{default:a(()=>[(_(!0),C(M,null,q(V.value,m=>(_(),z(u,{key:m.id,label:`${m.name} ${m.size}${m.unit}`,value:m.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),t.group.length>1?(_(),z(p,{key:0,type:"danger",link:"",onClick:m=>j(n,I),icon:ie(re)},null,8,["onClick","icon"])):L("",!0)])]),_:2},1032,["label"]))),128))])):L("",!0)]),_:1}),e(s,{label:"操作",width:"100"},{default:a(({row:t})=>[e(p,{type:"primary",link:"",onClick:n=>G(t)},{default:a(()=>l[9]||(l[9]=[r("添加组")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),N("div",fe,[e(p,{type:"primary",onClick:T},{default:a(()=>l[10]||(l[10]=[r("保存表")])),_:1,__:[10]}),e(p,{type:"primary",onClick:H},{default:a(()=>[r(se(y.value.length?"重新生成食谱":"生成食谱"),1)]),_:1})]),e($,null,{default:a(()=>[e(w,{stripe:"",data:y.value},{default:a(()=>[e(s,{prop:"name",label:"餐次",width:"100"}),e(s,{prop:"foods",label:"食物"})]),_:1},8,["data"])]),_:1}),e(P,{modelValue:F.value,"onUpdate:modelValue":l[5]||(l[5]=t=>F.value=t),title:"食物维护",width:"1000"},{default:a(()=>[e(w,{data:V.value,height:"60vh"},{default:a(()=>[e(s,{prop:"id",label:"ID",width:"80"}),e(s,{prop:"name",label:"食物"},{default:a(({row:t})=>[e(c,{modelValue:t.name,"onUpdate:modelValue":n=>t.name=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{prop:"size",label:"数量/重量"},{default:a(({row:t})=>[e(v,{"controls-position":"right",modelValue:t.size,"onUpdate:modelValue":n=>t.size=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{prop:"size",label:"卡路里"},{default:a(({row:t})=>[e(v,{"controls-position":"right",modelValue:t.cal,"onUpdate:modelValue":n=>t.cal=n},{suffix:a(()=>l[11]||(l[11]=[r(" 千卡 ")])),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{prop:"unit",label:"单位"},{default:a(({row:t})=>[e(g,{modelValue:t.unit,"onUpdate:modelValue":n=>t.unit=n,"allow-create":"",filterable:""},{default:a(()=>[e(u,{value:"g"}),e(u,{value:"个"}),e(u,{value:"片"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(s,{label:"操作",width:"120"},{default:a(({row:t})=>[e(p,{type:"primary",link:"",onClick:n=>R(t)},{default:a(()=>l[12]||(l[12]=[r("保存")])),_:2,__:[12]},1032,["onClick"]),e(p,{type:"danger",link:"",onClick:n=>S(t)},{default:a(()=>l[13]||(l[13]=[r("删除")])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}}),Ce=pe(ve,[["__scopeId","data-v-26112c4a"]]);export{Ce as default};
