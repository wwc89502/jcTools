import{i as j,j as h,k as f,b as s,w as o,n as q,l as m,E as G,y as L,x as N,G as O,z as R,u as A,A as D,p as J,D as W,q as r,F as H,d as K,H as Q,I as g,J as X,o as b,B as Y,C as z,_ as Z}from"./index-dlEj4opF.js";/* empty css                        *//* empty css                     *//* empty css                        *//* empty css                  *//* empty css                    */const ee={class:"transformer"},te={key:0,class:"upload-section"},le={key:1,class:"compress-section"},se={class:"compression-controls"},oe={class:"action-buttons"},ae={class:"files-list"},ne=j({__name:"Transformer",setup(ie){const n=h({quality:90,fileType:""}),w=["image/jpeg","image/png","image/webp"],S=t=>new Promise((e,c)=>{const a=document.createElement("canvas"),y=a.getContext("2d"),i=new Image;i.onload=()=>{a.width=i.width,a.height=i.height,y.drawImage(i,0,0);const v=n.value.fileType||t.type;a.toBlob(p=>{p?e(p):c(new Error("压缩失败"))},v,n.value.quality/100)},i.onerror=()=>c(new Error("图片加载失败")),i.src=URL.createObjectURL(t)}),B=t=>{if(t===0)return"0 B";const e=1024,c=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return`${(t/Math.pow(e,a)).toFixed(2)} ${c[a]}`},d=h([]),_=h(!1),T=t=>{const e=t.raw;if(e){if(!w.includes(e.type)){z.error("只支持 JPG/PNG/WEBP 格式的图片");return}d.value.push({id:Date.now()+Math.random(),name:e.name,size:e.size,type:e.type,file:e,status:"pending",compressedBlob:null,compressedSize:null})}},x=async()=>{if(!_.value){_.value=!0;try{for(const t of d.value){t.status="compressing";try{const e=await S(t.file);t.compressedBlob=e,t.compressedSize=e.size,t.status="done"}catch{t.status="error",z.error(`压缩失败: ${t.name}`)}}}finally{_.value=!1}}},E=t=>{if(!t.compressedBlob)return;const e=document.createElement("a");let a=t.name.replace(/\.(jpg|jpeg|png|webp)$/i,`.${t.compressedBlob.type.split("/")[1]}`);e.download=`compressed_${a}`,e.href=URL.createObjectURL(t.compressedBlob),e.click()},C=()=>{d.value.filter(t=>t.compressedBlob).forEach(t=>E(t))},M=()=>{d.value=[]},F=t=>({pending:"待处理",compressing:"压缩中",done:"已完成",error:"失败"})[t],V=t=>({pending:"info",compressing:"warning",done:"success",error:"danger"})[t];return(t,e)=>{const c=R,a=q,y=W,i=J,v=G,p=L,$=Y,I=N,u=Q,P=X,U=O;return b(),f("div",ee,[d.value.length?(b(),f("div",le,[m("div",se,[s(v,{model:n.value,"label-position":"top"},{default:o(()=>[s(i,{label:`压缩质量 (${n.value.quality}%)`},{default:o(()=>[s(y,{modelValue:n.value.quality,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value.quality=l),min:1,max:100},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),m("div",oe,[s(p,{type:"primary",onClick:x,loading:_.value},{default:o(()=>e[3]||(e[3]=[r(" 开始压缩 ")])),_:1,__:[3]},8,["loading"]),s(I,{modelValue:n.value.fileType,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.fileType=l),placeholder:"同时转换格式"},{default:o(()=>[(b(),f(H,null,K(w,(l,k)=>s($,{key:k,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),s(p,{disabled:_.value,onClick:M},{default:o(()=>e[4]||(e[4]=[r("重新选择")])),_:1,__:[4]},8,["disabled"]),s(p,{type:"success",onClick:C,disabled:!d.value.some(l=>l.compressedBlob)},{default:o(()=>e[5]||(e[5]=[r(" 下载全部 ")])),_:1,__:[5]},8,["disabled"])])]),m("div",ae,[s(U,{data:d.value,style:{width:"100%"}},{default:o(()=>[s(u,{label:"文件名",prop:"name"}),s(u,{label:"原始大小",width:"120"},{default:o(({row:l})=>[r(g(B(l.size)),1)]),_:1}),s(u,{label:"压缩后大小",width:"120"},{default:o(({row:l})=>[r(g(l.compressedSize?B(l.compressedSize):"-"),1)]),_:1}),s(u,{label:"压缩率",width:"120"},{default:o(({row:l})=>[r(g(l.compressedSize?Math.round((1-l.compressedSize/l.size)*100).toString()+"%":"-"),1)]),_:1}),s(u,{label:"状态",width:"120"},{default:o(({row:l})=>[s(P,{type:V(l.status)},{default:o(()=>[r(g(F(l.status)),1)]),_:2},1032,["type"])]),_:1}),s(u,{label:"操作",width:"120",align:"center"},{default:o(({row:l})=>[s(p,{link:"",type:"primary",onClick:k=>E(l),disabled:!l.compressedBlob},{default:o(()=>e[6]||(e[6]=[r(" 下载 ")])),_:2,__:[6]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])])])):(b(),f("div",te,[s(a,{class:"upload-drop-zone",drag:"",multiple:"","auto-upload":!1,accept:"image/*","show-file-list":!1,onChange:T},{default:o(()=>[s(c,{class:"upload-icon"},{default:o(()=>[s(A(D))]),_:1}),e[2]||(e[2]=m("div",{class:"upload-text"},[m("h3",null,"将多张图片拖到此处，或点击上传"),m("p",null,"支持 PNG/JPG/WEBP 格式")],-1))]),_:1,__:[2]})]))])}}}),_e=Z(ne,[["__scopeId","data-v-4890f0bc"]]);export{_e as default};
