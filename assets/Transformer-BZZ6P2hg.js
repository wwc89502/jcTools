import{d as q,r as h,c as f,b as l,w as o,f as I,a as m,E as L,n as G,k as N,v as O,o as R,u as A,p as D,g as J,j as W,h as i,F as K,l as H,x as Q,y as g,z as X,q as b,s as Y,t as z,_ as Z}from"./index-BDn7l3ep.js";/* empty css                     */const ee={class:"transformer"},te={key:0,class:"upload-section"},se={key:1,class:"compress-section"},le={class:"compression-controls"},oe={class:"action-buttons"},ae={class:"files-list"},ne=q({__name:"Transformer",setup(re){const n=h({quality:90,fileType:""}),w=["image/jpeg","image/png","image/webp"],S=t=>new Promise((e,c)=>{const a=document.createElement("canvas"),y=a.getContext("2d"),r=new Image;r.onload=()=>{a.width=r.width,a.height=r.height,y.drawImage(r,0,0);const v=n.value.fileType||t.type;a.toBlob(p=>{p?e(p):c(new Error("压缩失败"))},v,n.value.quality/100)},r.onerror=()=>c(new Error("图片加载失败")),r.src=URL.createObjectURL(t)}),B=t=>{if(t===0)return"0 B";const e=1024,c=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(e));return`${(t/Math.pow(e,a)).toFixed(2)} ${c[a]}`},d=h([]),_=h(!1),T=t=>{const e=t.raw;if(e){if(!w.includes(e.type)){z.error("只支持 JPG/PNG/WEBP 格式的图片");return}d.value.push({id:Date.now()+Math.random(),name:e.name,size:e.size,type:e.type,file:e,status:"pending",compressedBlob:null,compressedSize:null})}},x=async()=>{if(!_.value){_.value=!0;try{for(const t of d.value)if(t.status!=="done"){t.status="compressing";try{const e=await S(t.file);t.compressedBlob=e,t.compressedSize=e.size,t.status="done"}catch{t.status="error",z.error(`压缩失败: ${t.name}`)}}}finally{_.value=!1}}},E=t=>{if(!t.compressedBlob)return;const e=document.createElement("a");let a=t.name.replace(/\.(jpg|jpeg|png|webp)$/i,`.${t.compressedBlob.type.split("/")[1]}`);e.download=`compressed_${a}`,e.href=URL.createObjectURL(t.compressedBlob),e.click()},M=()=>{d.value.filter(t=>t.compressedBlob).forEach(t=>E(t))},C=()=>{d.value=[]},F=t=>({pending:"待处理",compressing:"压缩中",done:"已完成",error:"失败"})[t],V=t=>({pending:"info",compressing:"warning",done:"success",error:"danger"})[t];return(t,e)=>{const c=R,a=I,y=W,r=J,v=L,p=G,$=Y,P=N,u=Q,U=X,j=O;return b(),f("div",ee,[d.value.length?(b(),f("div",se,[m("div",le,[l(v,{model:n.value,"label-position":"top"},{default:o(()=>[l(r,{label:`压缩质量 (${n.value.quality}%)`},{default:o(()=>[l(y,{modelValue:n.value.quality,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.quality=s),min:1,max:100},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"]),m("div",oe,[l(p,{type:"primary",onClick:x,loading:_.value},{default:o(()=>e[3]||(e[3]=[i(" 开始压缩 ")])),_:1,__:[3]},8,["loading"]),l(P,{modelValue:n.value.fileType,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.fileType=s),placeholder:"同时转换格式"},{default:o(()=>[(b(),f(K,null,H(w,(s,k)=>l($,{key:k,label:s,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),l(p,{onClick:C},{default:o(()=>e[4]||(e[4]=[i("重新选择")])),_:1,__:[4]}),l(p,{type:"success",onClick:M,disabled:!d.value.some(s=>s.compressedBlob)},{default:o(()=>e[5]||(e[5]=[i(" 下载全部 ")])),_:1,__:[5]},8,["disabled"])])]),m("div",ae,[l(j,{data:d.value,style:{width:"100%"}},{default:o(()=>[l(u,{label:"文件名",prop:"name"}),l(u,{label:"原始大小",width:"120"},{default:o(({row:s})=>[i(g(B(s.size)),1)]),_:1}),l(u,{label:"压缩后大小",width:"120"},{default:o(({row:s})=>[i(g(s.compressedSize?B(s.compressedSize):"-"),1)]),_:1}),l(u,{label:"压缩率",width:"120"},{default:o(({row:s})=>[i(g(s.compressedSize?Math.round((1-s.compressedSize/s.size)*100).toString()+"%":"-"),1)]),_:1}),l(u,{label:"状态",width:"120"},{default:o(({row:s})=>[l(U,{type:V(s.status)},{default:o(()=>[i(g(F(s.status)),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"操作",width:"120",align:"center"},{default:o(({row:s})=>[l(p,{link:"",type:"primary",onClick:k=>E(s),disabled:!s.compressedBlob},{default:o(()=>e[6]||(e[6]=[i(" 下载 ")])),_:2,__:[6]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])])])):(b(),f("div",te,[l(a,{class:"upload-drop-zone",drag:"",multiple:"","auto-upload":!1,accept:"image/*","show-file-list":!1,onChange:T},{default:o(()=>[l(c,{class:"upload-icon"},{default:o(()=>[l(A(D))]),_:1}),e[2]||(e[2]=m("div",{class:"upload-text"},[m("h3",null,"将多张图片拖到此处，或点击上传"),m("p",null,"支持 PNG/JPG/WEBP 格式")],-1))]),_:1,__:[2]})]))])}}}),ce=Z(ne,[["__scopeId","data-v-b38a4e01"]]);export{ce as default};
